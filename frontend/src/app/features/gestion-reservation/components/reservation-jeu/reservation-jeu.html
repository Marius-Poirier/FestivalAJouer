<div class="container">
  <div class="header">
    <div class="title-group">
      <h3>Jeux</h3>
      <span class="count">{{ jeuxCount() }}<small> jeu(x)</small></span>
    </div>

    @if (canManage()) {
      <div class="actions">
        <button type="button" class="btn" (click)="showAddJeux()">+ Ajouter jeux</button>
      </div>
    }
  </div>

  @if (isAddingJeu()) {
    <div class="add-row">
      <mat-form-field appearance="fill" class="field">
        <mat-label>Jeu (éditeur)</mat-label>

        <mat-select
          [value]="selectedJeuId()"
          (valueChange)="selectedJeuId.set($event)">

          @if (!availableEditeurJeux().length) {
            <mat-option disabled>Plus de jeux disponibles</mat-option>
          }

          @for (j of availableEditeurJeux(); track j.id) {
            <mat-option [value]="j.id">{{ j.nom }}</mat-option>
          }
        </mat-select>
      </mat-form-field>

      <div class="add-actions">
        <button
          type="button"
          class="btn"
          (click)="addJeuToReservation()"
          [disabled]="!selectedJeuId() || !availableEditeurJeux().length">
          Ajouter
        </button>

        <button type="button" class="btn secondary" (click)="hideAddJeux()">Annuler</button>
      </div>
    </div>
  }

  @if (isLoading()) {
    <p>Chargement...</p>
  } @else if (error()) {
    <p class="error">{{ error() }}</p>
  } @else {
    @if (reservationJeux().length === 0) {
      <p>Aucun jeu ajouté pour cette réservation.</p>
    } @else {
      <ul class="simple-list">
        @for (l of reservationJeux(); track l.id) {
          <li class="item" (click)="openJeuDetail(l.jeu_id)">
            <div class="item-left">
                           
              @if (l.url_image) {
                <img class="jeu-image" [src]="l.url_image" [alt]="l.jeu_nom" loading="lazy" />
              }           
              <div class="item-info">
                <div class="name">{{ l.jeu_nom }}</div>
                <div class="meta">
                  @if (l.type_jeu_nom) {<span class="meta-item">{{ l.type_jeu_nom }}</span>}
                  @if (l.nb_joueurs_min || l.nb_joueurs_max) {
                    <span class="meta-item">Joueurs: {{ l.nb_joueurs_min ?? '-' }} - {{ l.nb_joueurs_max ?? '-' }}</span>
                  }
                  @if (l.duree_minutes) {<span class="meta-item">Durée: {{ l.duree_minutes }} min</span>}
                  @if (l.age_min || l.age_max) {
                    <span class="meta-item">Âge: {{ l.age_min ?? '-' }} - {{ l.age_max ?? '-' }}</span>
                  }
                  @if (l.theme) {<span class="meta-item">Thème: {{ l.theme }}</span>}
                </div>
              </div>
            </div>

            @if (canManage()) {
              <button
                type="button"
                class="btn-remove"
                (click)="removeJeu(l.id); $event.stopPropagation()"
                aria-label="Retirer">
                <mat-icon>close</mat-icon>
              </button>
            }
          </li>
        }
      </ul>
    }
  }
</div>
