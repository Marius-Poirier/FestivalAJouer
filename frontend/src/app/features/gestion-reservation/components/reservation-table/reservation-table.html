<div class="tables-tab">
  <div class="header">
    <div class="title-group">
      <h3>Tables</h3>
      <span class="count">{{ nbr_tables() }}<small> table(s)</small></span>
    </div>

    <div class="actions">
      <button type="button" class="btn" (click)="showAddTable()">+ Ajouter table</button>
    </div>
  </div>

  @if (isAddTable() && reservationId()) {
    <app-add-table-reservation 
      [reservationId]="reservationId() ?? undefined"
      (close)="closeAddModal()"
      (added)="handleTableAdded()"
    ></app-add-table-reservation>
  }

  @if (showRemoveConfirm()) {
    <div class="confirm-overlay" (click)="closeRemoveConfirm()">
      <div class="confirm-popup" (click)="$event.stopPropagation()">
        <h3>Retirer la table ?</h3>
        <p>Êtes-vous sûr de vouloir retirer cette table de la réservation ?</p>
        <div class="confirm-actions">
          <button type="button" class="btn secondary" (click)="closeRemoveConfirm()">Annuler</button>
          <button type="button" class="btn danger" (click)="confirmRemoveTable()">Retirer</button>
        </div>
      </div>
    </div>
  }

  @if (loading()) {
    <div class="placeholder">
      <p>⏳ Chargement des tables...</p>
    </div>
  }

  @if (error() && !loading()) {
    <div class="error-message">
      <p>❌ {{ error() }}</p>
    </div>
  }

  @if (!loading() && tables().length === 0 && !error()) {
    <div class="placeholder">
      <p>⚠️ Aucune table attribuée pour le moment.</p>
      @if (reservationId()) {
        <small>ID réservation : {{ reservationId() }}</small>
      }
    </div>
  }

  @if (!loading() && tables().length > 0) {
    <div class="summary">
      <p>
        <strong>Prix Total : {{prix_total()}} €</strong>
      </p>
    </div>

    <div class="tables-list">
      @for (table of tables(); track table.id) {
          <div class="card-table">
            <button type="button" class="btn-rolldown" (click)="toggleTableJeux(table.id!)">
              <span [class.open]="openTableJeux()[table.id!]">&#9660;</span>
            </button>
            <app-table-card 
                [table]="table"
                (onRemove)="handleRemoveTable($event)">
            </app-table-card>
            <button type="button" class="btn btn-add-jeu">Ajouter jeu</button>
            <button type="button" class="btn btn-remove" (click)="handleRemoveTable(table.id!)">Retirer table</button>
          </div>
          @if (openTableJeux()[table.id!]) {
            <div class="table-jeux-list">
              <!-- Affichage des jeux de la table ici -->
              <p>Jeux de la table {{ table.id }} :</p>
              <!-- TODO: Remplacer par la vraie liste -->
            </div>
          }
      }
    </div>
  }
</div>
