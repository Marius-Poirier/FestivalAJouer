<div class="list-container">
  @if (jeuService.error()) {
    <div class="error-banner">
      {{ jeuService.error() }}
    </div>
  }

  <div class="header-controls">
    <div class="search-bar">
      <mat-icon class="search-icon">search</mat-icon>
      <input
        type="text"
        placeholder="Rechercher un jeu..."
        [value]="searchTerm()"
        (input)="onSearch($event)"
      />
    </div>

    @if (authService.isAdminSuperorgaOrga()) {
      <button class="btn-add" (click)="toggleForm()">+ Ajouter un jeu</button>
    }
  </div>

  <!-- FILTRES TYPES -->
  @if (typeOptions().length > 0) {
    <div class="type-filters">
      <div class="type-header">
        <div class="type-title">
          Types
          <span class="type-subtitle">
            ({{ filteredJeux().length }} / {{ jeuService.jeux().length }})
          </span>
        </div>

        <button
          type="button"
          class="btn-reset"
          (click)="clearTypes()"
          [disabled]="selectedTypes().size === 0">
          Tout afficher
        </button>
      </div>

      <div class="chips">
        @for (t of typeOptions(); track t) {
          <label class="chip" [class.active]="selectedTypes().has(t)">
            <input
              class="chip-input"
              type="checkbox"
              [checked]="selectedTypes().has(t)"
              (change)="toggleType(t, $any($event.target).checked)"
            />
            <span class="dot"></span>
            <span>{{ t }}</span>
          </label>
        }
      </div>
    </div>
  }

  @if (jeuService.isLoading() && !jeuService.jeux().length) {
    <p class="loading">Chargement des jeux...</p>
  } @else {
    <ul class="jeux-list">
      @for (jeu of paginatedJeux(); track jeu.id) {
        <li>
          <app-jeu-card
            [jeu]="jeu"
            [canManage]="authService.isAdminSuperorgaOrga()"
            (delete)="onDelete($event)"
            (detail)="onDetail($event)"
            (update)="onUpdate($event)"
          ></app-jeu-card>
        </li>
      }
    </ul>

    @if (totalPages() > 1) {
      <div class="pagination">
        <button
          type="button"
          class="page-btn"
          (click)="previousPage()"
          [disabled]="currentPage() === 1">
          ← Précédent
        </button>

        <span class="page-info">
          Page {{ currentPage() }} / {{ totalPages() }}
        </span>

        <button
          type="button"
          class="page-btn"
          (click)="nextPage()"
          [disabled]="currentPage() === totalPages()">
          Suivant →
        </button>
      </div>
    }
  }

  @if (showForm()) {
    <app-jeu-form
      [jeu]="editingJeu()"
      [mode]="editingJeu() ? 'edit' : 'create'"
      (closeForm)="onFormClosed()">
    </app-jeu-form>
  }
</div>
