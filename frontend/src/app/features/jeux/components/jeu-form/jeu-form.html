<div class="from-jeu-container" (click)="close()">
  <form
    class="jeu-form"
    [formGroup]="form"
    (ngSubmit)="onSubmit()"
    (click)="$event.stopPropagation()"
  >
    <h2 class="add">
      @if (mode() === 'edit') {
        Modifier un jeu
      } @else {
        Ajouter un jeu
      }
    </h2>

    @if (jeuService.error()) {
      <div class="error-message">
        {{ jeuService.error() }}
      </div>
    }

    <div class="form-scroll">
      <!-- 1) Nom -->
      <mat-form-field appearance="fill">
        <mat-label>Nom du jeu</mat-label>
        <input
          matInput
          type="text"
          formControlName="nom"
          placeholder="Nom du jeu"
          [disabled]="jeuService.isLoading()"
        />
      </mat-form-field>

      @if (form.controls.nom.invalid && form.controls.nom.touched) {
        @if (form.controls.nom.hasError('required')) {
          <span class="error-text-input">
            Le nom est requis
          </span>
        } @else if (form.controls.nom.hasError('minlength')) {
          <span class="error-text-input">
            Le nom doit contenir au moins 3 caractères
          </span>
        }
      }

      <!-- 2) Éditeur(s) -->
      <mat-form-field appearance="fill">
        <mat-label>Éditeur(s)</mat-label>
        <mat-select formControlName="editeurs_ids" multiple>
          @for (edi of editeurService.editeurs(); track edi.id) {
            <mat-option [value]="edi.id">
              {{ edi.nom }}
            </mat-option>
          }
        </mat-select>
      </mat-form-field>

      <!-- 3) Type de jeu -->
      <mat-form-field appearance="fill">
        <mat-label>Type de jeu</mat-label>
        <mat-select formControlName="type_jeu_id">
          <mat-option [value]="null">Sans type</mat-option>
          @for (t of typesJeu; track t.id) {
            <mat-option [value]="t.id">
              {{ t.nom }}
            </mat-option>
          }
        </mat-select>
      </mat-form-field>

      <!-- Nb joueurs -->
      <mat-form-field appearance="fill">
        <mat-label>Nombre de joueurs minimum</mat-label>
        <input
          matInput
          type="number"
          formControlName="nb_joueurs_min"
          [disabled]="jeuService.isLoading()"
        />
      </mat-form-field>

      <mat-form-field appearance="fill">
        <mat-label>Nombre de joueurs maximum</mat-label>
        <input
          matInput
          type="number"
          formControlName="nb_joueurs_max"
          [disabled]="jeuService.isLoading()"
        />
      </mat-form-field>

      <!-- Durée -->
      <mat-form-field appearance="fill">
        <mat-label>Durée (minutes)</mat-label>
        <input
          matInput
          type="number"
          formControlName="duree_minutes"
          [disabled]="jeuService.isLoading()"
        />
      </mat-form-field>

      <!-- Âge -->
      <mat-form-field appearance="fill">
        <mat-label>Âge minimum</mat-label>
        <input
          matInput
          type="number"
          formControlName="age_min"
          [disabled]="jeuService.isLoading()"
        />
      </mat-form-field>

      <mat-form-field appearance="fill">
        <mat-label>Âge maximum</mat-label>
        <input
          matInput
          type="number"
          formControlName="age_max"
          [disabled]="jeuService.isLoading()"
        />
      </mat-form-field>

      <!-- Thème -->
      <mat-form-field appearance="fill">
        <mat-label>Thème</mat-label>
        <input
          matInput
          type="text"
          formControlName="theme"
          [disabled]="jeuService.isLoading()"
        />
      </mat-form-field>

      <!-- Description -->
      <mat-form-field appearance="fill">
        <mat-label>Description</mat-label>
        <textarea
          matInput
          rows="3"
          formControlName="description"
          [disabled]="jeuService.isLoading()"
        ></textarea>
      </mat-form-field>

      <!-- Lien règles -->
      <mat-form-field appearance="fill">
        <mat-label>Lien vers les règles</mat-label>
        <input
          matInput
          type="url"
          formControlName="lien_regles"
          [disabled]="jeuService.isLoading()"
        />
      </mat-form-field>

      <!-- Image -->
      <mat-form-field appearance="fill">
        <mat-label>URL de l'image</mat-label>
        <input
          matInput
          type="url"
          formControlName="url_image"
          [disabled]="jeuService.isLoading()"
        />
      </mat-form-field>

      <!-- Vidéo -->
      <mat-form-field appearance="fill">
        <mat-label>URL de la vidéo</mat-label>
        <input
          matInput
          type="url"
          formControlName="url_video"
          [disabled]="jeuService.isLoading()"
        />
      </mat-form-field>

      <!-- Prototype -->
      <mat-checkbox formControlName="prototype">
        Prototype
      </mat-checkbox>
    </div>

    <button
      type="submit"
      mat-raised-button
      color="primary"
      [disabled]="form.invalid || jeuService.isLoading()"
    >
      @if (jeuService.isLoading()) {
        Enregistrement...
      } @else if (mode() === 'edit') {
        Mettre à jour
      } @else {
        Enregistrer
      }
    </button>

    <button
      type="button"
      (click)="close()"
      mat-raised-button
      [disabled]="jeuService.isLoading()"
    >
      Fermer
    </button>
  </form>
</div>
