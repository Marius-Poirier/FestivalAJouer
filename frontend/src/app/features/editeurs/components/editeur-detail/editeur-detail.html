<div class="detail-container">
  <button type="button" class="back-link" (click)="goBack()">
    ← Retour
  </button>

  @if (isLoading()) {
    <p>Chargement de l’éditeur…</p>
  } @else if (error()) {
    <p class="error">{{ error() }}</p>
  } @else if (editeur()) {
    @let edi = editeur()!;

    <h1>Détail de l’éditeur</h1>

    <section class="card">
      <div class="card-head">
        @if (edi.logo_url) {
          <img class="editeur-logo" [src]="edi.logo_url" [alt]="edi.nom" loading="lazy" />
        }

        <div class="card-head-text">
          <h2>{{ edi.nom }}</h2>
          <p><strong>ID :</strong> {{ edi.id }}</p>
        </div>
      </div>
    </section>

    <!-- CONTACTS -->
    @if (canSeeContacts()) {
      <section class="contacts">
        <div class="section-head">
          <h2>Contacts</h2>

          @if (canManageContacts()) {
            <button type="button" class="btn-secondary" (click)="toggleAddContact()">
              @if (showAddContact()) { Fermer } @else { + Ajouter un contact }
            </button>
          }
        </div>

        @if (personnesLoading()) {
          <p>Chargement des contacts...</p>
        } @else if (personnesError()) {
          <p class="error">{{ personnesError() }}</p>
        } @else {

          @if (canManageContacts()) {
            @if (showAddContact()) {
              <form class="contact-form" [formGroup]="contactForm" (ngSubmit)="submitContact()">
                <div class="form-grid">
                  <div class="form-group">
                    <label>Prénom *</label>
                    <input type="text" formControlName="prenom" placeholder="Ex: Marie" />
                  </div>

                  <div class="form-group">
                    <label>Nom *</label>
                    <input type="text" formControlName="nom" placeholder="Ex: Dupont" />
                  </div>

                  <div class="form-group">
                    <label>Téléphone *</label>
                    <input type="text" formControlName="telephone" placeholder="Ex: 0612345678" />
                  </div>

                  <div class="form-group">
                    <label>Email</label>
                    <input type="email" formControlName="email" placeholder="Ex: contact@email.com" />
                  </div>

                  <div class="form-group">
                    <label>Fonction</label>
                    <input type="text" formControlName="fonction" placeholder="Ex: Responsable commercial" />
                  </div>
                </div>

                <div class="form-actions">
                  <button type="submit" class="btn-primary" [disabled]="contactForm.invalid">
                    Ajouter
                  </button>
                </div>
              </form>
            }
          }

          @if (personnes().length) {
            <ul class="contacts-list">
              @for (p of personnes(); track p.id) {
                <li class="contact-item">
                  <div class="contact-main">
                    <div class="contact-name">
                      {{ p.prenom }} {{ p.nom }}
                      @if (p.fonction) {
                        <span class="contact-role">• {{ p.fonction }}</span>
                      }
                    </div>

                    <div class="contact-meta">
                      <span>{{ p.telephone }}</span>
                      @if (p.email) {
                        <span>• {{ p.email }}</span>
                      }
                    </div>
                  </div>

                  @if (canManageContacts()) {
                    <button
                      type="button"
                      class="btn-danger"
                      (click)="removePersonne(p.id!)">
                      Retirer
                    </button>
                  }
                </li>
              }
            </ul>
          } @else {
            <p>Aucun contact pour le moment.</p>
          }
        }
      </section>
    }

    <!-- JEUX -->
    <section class="games">
      <h2>Jeux de cet éditeur</h2>

      @if (jeuxLoading()) {
        <p>Chargement des jeux...</p>
      } @else if (jeuxError()) {
        <p class="error">{{ jeuxError() }}</p>
      } @else if (jeux().length) {
        <ul class="games-list">
          @for (jeu of jeux(); track jeu.id) {
            <li>
              <a [routerLink]="['/jeux', jeu.id]">
                {{ jeu.nom }}
              </a>
            </li>
          }
        </ul>
      } @else {
        <p>Aucun jeu associé pour le moment.</p>
      }
    </section>
  } @else {
    <p>Éditeur introuvable.</p>
  }
</div>
