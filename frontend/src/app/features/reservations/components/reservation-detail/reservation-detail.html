@if (isLoading()) {
  <div class="loading-container">
    <p>Chargement...</p>
  </div>
} @else if (reservation() && editeur() && festival()) {
  @let res = reservation()!;
  <div class="detail-container">

    <div class="header">
      <h1 class="title">RÃ©servation #{{ res.id }}</h1>
        @if (this.authSvc.isAdminSuperorgaOrga()) {
          <div class="actions">
            @if (res.statut_workflow == 'PAIEMENT_RECU'.toLowerCase() && !this.authSvc.isAdminSuperorga()) {
              <button type="button" class="btn" disabled title="RÃ©servation verrouillÃ©e">
                Modifier ðŸ”’
              </button>

            } @else {
                <button type="button" class="btn" (click)="onModifier()">Modifier</button>
            }
            <button type="button" class="btn danger" (click)="onSupprimer()">Supprimer</button>
          </div>
        }
    </div>


    <div class="info-section">
      <p><strong>Ã‰diteur :</strong> {{ editeur()!.nom }}</p>
      <p><strong>Festival :</strong> {{ festival() ? festival()!.nom : 'Chargement...' }}</p>
      
      <p><strong>Statut :</strong> {{ workflowLabel() }}</p>
      <p><strong>PrÃ©sente des jeux :</strong> {{ res.editeur_presente_jeux ? 'Oui' : 'Non' }}</p>
      <p><strong>Prix final :</strong> <span class="prix-final">{{ prixFinal() }} â‚¬</span></p>    
    </div>

    <!-- ONGLETS -->
    <div class="tabs-container">
      <div class="tabs-header">
        <mat-radio-group aria-label="SÃ©lectionner un onglet" [value]="activeTab()" (change)="onTabChange($event)">
          <mat-radio-button value="informations">Informations</mat-radio-button>
          <mat-radio-button value="tables">Tables</mat-radio-button>
          <mat-radio-button value="jeux">Jeux</mat-radio-button>
          <mat-radio-button value="workflow">Workflow</mat-radio-button>
        </mat-radio-group>
      </div>

      <div class="tab-content">
        @switch (activeTab()) {
          @case ('informations') {
            <div class="tab-panel">
              <app-reservation-info [reservation]="reservation()" [editeurNom]="editeur() ? editeur()!.nom : null"></app-reservation-info>
            </div>
          }
          @case ('tables') { 
            <div class="tab-panel">
              <app-reservation-table 
                [reservationId]="reservationId()"
                [festivalId]="festivalId()">
              </app-reservation-table>
            </div>
          }
          @case ('jeux') {
            <div class="tab-panel">
              <app-reservation-jeu
                [festivalId]="festivalId()"
                [reservationId]="reservationId()"
                [editeurId]="res.editeur_id">
              </app-reservation-jeu>
            </div>
          }
          @case ('workflow') { 
              <div class="tab-panel">
                <h3>Historique des commentaires</h3>
                @if (parseCommentaires().length === 0) {
                  <p class="empty">Aucun commentaire pour le moment</p>
                    } @else {
                      <ul class="commentaires-list">
                        @for (commentaire of parseCommentaires(); track $index) {
                          <li class="commentaire-item">
                            <p class="commentaire-texte">{{ commentaire.texte }}</p>
                          </li>
                        }
                      </ul>
                    }
                  </div>
               }
          }
      </div>
    </div>
  </div>
    <!-- Modal d'Ã©dition -->
    @if (showEditModal()) {
      <app-reservation-form
        [reservation]="reservation()"
        (closeForm)="onCloseEditModal()"
      ></app-reservation-form>
    }

  @if (showDeletePopup()) {
    <app-popup-delete
      [entiteType]="'reservation'"
      [entiteId]="reservationId()"
      [entitenom]="editeur() ? editeur()!.nom : ''"
      (confirm)="onConfirmDelete()"
      (cancel)="onCancelDelete()"
    />
  }
} @else {
  <div class="error-container">
    <p>Erreur: RÃ©servation introuvable</p>
  </div>
}
